{"version":3,"sources":["fio-checkout.js"],"names":["$","fioPayment","init","initialize","length","this","form","email","data","amount","currency","fioAddress","fioAmount","fioRef","infoWrapper","amountWrapper","process","QRCode","text","toUpperCase","replace","size","fill","quiet","ratio","is","attr","on","options","classname","id","target","document","getElementById","nanobar","Nanobar","updateFioAmount","ajaxGetFioAmount","done","res","console","log","success","checkForFioPayment","go","ajax","url","wc_fio_params","wc_ajax_url","type","action","nounce","match","trigger","setTimeout","fail","err","e","jQuery"],"mappings":"CAAA,SAAAA,GACA,GAAAC,IACAC,KAAA,WAEAF,EAAAG,WAAA,UAAA,WAEAH,EAAA,aAAAI,SACAC,KAAAC,KAAAN,EAAA,aACAK,KAAAE,MAAAF,KAAAC,KAAAE,KAAA,SACAH,KAAAI,OAAAJ,KAAAC,KAAAE,KAAA,UACAH,KAAAK,SAAAL,KAAAC,KAAAE,KAAA,YACAH,KAAAM,WAAAN,KAAAC,KAAAE,KAAA,eACAH,KAAAO,UAAAP,KAAAC,KAAAE,KAAA,cACAH,KAAAQ,OAAAR,KAAAC,KAAAE,KAAA,WACAH,KAAAS,YAAA,YACAT,KAAAU,cAAA,sBACAV,KAAAW,QAAA,gBAgBA,GAAAC,QAAA,UACAC,KAAAb,KAAAM,WAAAQ,cAAAC,QAAA,KAAA,IACAC,KAAA,IACAC,KAAA,OACAC,MAAA,EACAC,MAAA,IAWAxB,EAAA,sCAAAyB,GAAA,YACAzB,EAAA,gBAAA0B,KAAA,YAAA,GAEA1B,EAAA,gBAAA0B,KAAA,YAAA,GAIA1B,EAAA,6BAAA2B,GAAA,QAAA,+BAAA,WACA3B,EAAAK,MAAAoB,GAAA,uBACAzB,EAAA,gBAAA0B,KAAA,YAAA,GAEA1B,EAAA,gBAAA0B,KAAA,YAAA,IAIA,IAAAE,IACAC,UAAA,cACAC,GAAA,cACAC,OAAAC,SAAAC,eAAA,eAGAhC,GAAAiC,QAAA,GAAAC,SAAAP,MAKAQ,gBAAA,WACA/B,KAAAgC,mBAAAC,KAAA,SAAAC,GACAC,QAAAC,IAAAF,IAEA,IAAAA,EAAAG,SAAAH,EAAA/B,KAAAC,OAAA,GACAT,EAAAK,KAAAU,eAAAG,KAAAqB,EAAA/B,KAAAC,WAKAkC,mBAAA,WACAtC,KAAA6B,QAAAU,GAAA,IACAJ,QAAAC,IAAA,YACAzC,EAAA6C,MACAC,IAAAC,cAAAC,YACAC,KAAA,OACAzC,MACA0C,OAAA,gCACAC,OAAAJ,cAAAI,UAEAb,KAAA,SAAAC,GAEAC,QAAAC,IAAAF,GACAC,QAAAC,IAAA,UAAAF,EAAA/B,KAAA4C,QACA,IAAAb,EAAAG,UAAA,IAAAH,EAAA/B,KAAA4C,QACApD,EAAA,gBAAA0B,KAAA,YAAA,GACA1B,EAAA,gBAAAqD,QAAA,UAEAC,WAAA,WACArD,EAAA0C,sBACA,OACAY,KAAA,SAAAC,GACAhB,QAAAC,IAAA,aACAD,QAAAC,IAAAe,KAEAnD,KAAA6B,QAAAU,GAAA,MAGAP,iBAAA,WACA,MAAArC,GAAA6C,MACAC,IAAAC,cAAAC,YACAC,KAAA,OACAzC,MACA0C,OAAA,6BACAC,OAAAJ,cAAAI,WAMAlD,GAAAC,OACAoD,WAAA,WACA,IACArD,EAAA0C,qBACA,MAAAc,GACAjB,QAAAC,IAAAgB,KAEA,MAEAC","file":"../fio-checkout.min.js","sourcesContent":["(function( $ ) {\n    var fioPayment = {\n        init: function () {\n\n            $.initialize(\"#fio-qr\", function() {\n                //Get form\n                if ( $( '#fio-form' ).length ) {\n                    this.form = $('#fio-form');\n                    this.email = this.form.data('email');\n                    this.amount = this.form.data('amount');\n                    this.currency = this.form.data('currency');\n                    this.fioAddress = this.form.data('fio-address');\n                    this.fioAmount = this.form.data('fio-amount');\n                    this.fioRef = this.form.data('fio-ref');\n                    this.infoWrapper = '#fio-info';\n                    this.amountWrapper = '#fio-amount-wrapper';\n                    this.process = '#fio-process';\n                }\n\n                //Prepare NEM qr code data\n                // Invoice model for QR\n                /* this.paymentData = {\n                    \"v\": wc_fio_params.test ? 1 : 2,\n                    \"type\": 2,\n                    \"data\": {\n                        \"addr\": this.fioAddress.toUpperCase().replace(/-/g, ''),\n                        \"amount\": this.fioAmount * 1000000,\n                        \"msg\": this.fioRef,\n                        \"name\": \"FIO payment to \" + wc_fio_params.store\n                    }\n                }; */\n                //Generate the QR code with address\n                new QRCode(\"fio-qr\", {\n                    text: this.fioAddress.toUpperCase().replace(/-/g, ''),\n                    size: 256,\n                    fill: '#000',\n                    quiet: 0,\n                    ratio: 2\n                });\n\n                /*Add copy functinality to amount, ref and nem address*/\n                if(false && Clipboard.isSupported()){\n                    new Clipboard('#fio-amount-wrapper');\n                    new Clipboard('#fio-address-wrapper');\n                    new Clipboard('#fio-ref-wrapper');\n                }\n\n                //Set payment button to disabled if whole chech is updated.\n                if($( 'div.payment_box.payment_method_fio' ).is(':visible')){\n                    $( '#place_order' ).attr( 'disabled', true);\n                }else{\n                    $( '#place_order' ).attr( 'disabled', false);\n                }\n\n                /*Set pay button to disabled and start waiting for payments*/\n                $('.wc_payment_methods  > li').on( 'click', 'input[name=\"payment_method\"]',function () {\n                    if ( $( this ).is( '#payment_method_fio' ) ) {\n                        $( '#place_order' ).attr( 'disabled', true);\n                    }else{\n                        $( '#place_order' ).attr( 'disabled', false)\n                    }\n                });\n\n                var options = {\n                    classname: 'nanobar-fio',\n                    id: 'fio-nanobar',\n                    target: document.getElementById('fio-process')\n                };\n\n                fioPayment.nanobar = new Nanobar( options );\n            });\n\n\n        },\n        updateFioAmount: function () {\n            this.ajaxGetFioAmount().done(function (res) {\n                console.log(res);\n\n                if(res.success === true && res.data.amount > 0){\n                    $(this.amountWrapper).text(res.data.amount)\n                }\n            });\n\n        },\n        checkForFioPayment: function () {\n            this.nanobar.go(25);\n            console.log(\"checking\");\n            $.ajax({\n                url: wc_fio_params.wc_ajax_url,\n                type: 'post',\n                data: {\n                    action: 'woocommerce_check_for_payment',\n                    nounce: wc_fio_params.nounce\n                }\n            }).done(function (res) {\n                // $('#fio-check').html('<p id=\"fio-check\">Checking..</p>');\n                console.log(res);\n                console.log(\"Match: \" + res.data.match);\n                if(res.success === true && res.data.match === true){\n                    $( '#place_order' ).attr( 'disabled', false);\n                    $( '#place_order' ).trigger( 'click');\n                }\n                setTimeout(function() {\n                    fioPayment.checkForFioPayment();\n                }, 5000);\n            }).fail(function (err) {\n                console.log(\"epic fail\");\n                console.log(err);\n            });\n            this.nanobar.go(100);\n        },\n\n        ajaxGetFioAmount: function () {\n            return $.ajax({\n                url: wc_fio_params.wc_ajax_url,\n                type: 'post',\n                data: {\n                    action: 'woocommerce_get_fio_amount',\n                    nounce: wc_fio_params.nounce\n                }\n            })\n        }\n    };\n\n    fioPayment.init();\n    setTimeout(function() {\n        try {\n            fioPayment.checkForFioPayment();\n        } catch (e) {\n            console.log(e);\n        }\n    }, 5000);\n\n})( jQuery );\n"]}